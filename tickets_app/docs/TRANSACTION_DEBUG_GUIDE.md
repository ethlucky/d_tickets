# 交易调试指南

## 🔍 问题分析

您执行了转账操作，但目标地址 `2XM48QdtTv3dAHccUjVdZ2CF7Es3estfNRAqjjde8QdL` 的余额没有变化。

## 📊 调试步骤

### 1. **检查网络连接**

确认应用连接的网络与您查询的网络一致：

```bash
# 您查询的是本地网络
solana balance 2XM48QdtTv3dAHccUjVdZ2CF7Es3estfNRAqjjde8QdL --url http://localhost:8899
```

**应用配置**：
- Android: `http://10.0.2.2:8899`
- iOS: `http://127.0.0.1:8899`
- 都指向本地 Solana 测试网络

### 2. **查看详细日志**

现在应用会输出详细的调试信息，请执行转账操作并查看控制台输出：

#### 预期的日志输出：
```
🚀 开始创建真实的 SOL 转账交易...
📡 获取最新区块哈希...
✅ 区块哈希: [真实的区块哈希]
🔨 构建 SOL 转账交易...
✅ 交易构建完成
📝 请求用户签名...

📊 交易字节长度: [字节数]
📊 交易类型检查...
🔍 开始检查交易类型...
🔍 交易字节长度: [字节数]
🔍 JSON 解析失败，可能是二进制交易数据: [错误信息]
🔍 交易字节前10个字节: [字节数组]
🔍 检测到二进制数据，判断为真实交易
📊 是否为真实交易: true

✅ 交易签名完成: [签名]
🚀 开始发送真实交易到网络...
✅ 交易发送成功: [交易哈希]
🔄 刷新钱包余额...
✅ 余额已刷新
```

#### 如果看到这些日志：
```
🔍 成功解析为 JSON，这是模拟数据
📊 是否为真实交易: false
ℹ️ 检测到模拟交易数据，不会发送到网络
```
**说明**：使用的是模拟数据，不会真正发送交易。

### 3. **使用新增的检查功能**

点击 **"检查目标地址余额"** 按钮，这会：
- 直接查询目标地址的当前余额
- 显示详细的余额信息
- 确认网络连接是否正常

### 4. **验证本地网络状态**

检查本地 Solana 测试网络是否正常运行：

```bash
# 检查网络状态
solana cluster-version --url http://localhost:8899

# 检查最新区块
solana block-height --url http://localhost:8899

# 检查您的钱包余额
solana balance [您的钱包地址] --url http://localhost:8899
```

### 5. **手动验证交易**

如果应用显示交易成功，您可以使用交易哈希验证：

```bash
# 使用交易哈希查询交易详情
solana transaction [交易哈希] --url http://localhost:8899
```

## 🔧 可能的问题和解决方案

### 问题1：使用了模拟数据
**症状**：日志显示 "检测到模拟交易数据"
**解决**：确保使用 `TransactionBuilder.createSolTransfer()` 创建真实交易

### 问题2：网络不匹配
**症状**：应用连接的网络与查询的网络不同
**解决**：确保查询的 URL 与应用配置一致

### 问题3：交易失败但没有报错
**症状**：显示交易成功但余额没变化
**解决**：检查交易哈希，查看具体的失败原因

### 问题4：本地网络问题
**症状**：无法获取区块哈希或发送交易失败
**解决**：重启本地 Solana 测试网络

### 问题5：钱包余额不足
**症状**：交易被拒绝或失败
**解决**：确保发送方钱包有足够的 SOL

## 🎯 调试检查清单

### 执行前检查：
- [ ] 本地 Solana 网络正在运行
- [ ] 钱包已连接
- [ ] 钱包有足够的 SOL 余额（至少 0.02 SOL）
- [ ] 目标地址格式正确

### 执行时检查：
- [ ] 查看控制台日志输出
- [ ] 确认交易类型检测结果
- [ ] 记录交易哈希（如果有）
- [ ] 注意任何错误信息

### 执行后检查：
- [ ] 使用 "检查目标地址余额" 按钮验证
- [ ] 使用命令行查询余额变化
- [ ] 如果有交易哈希，查询交易详情

## 📝 调试命令

### 查询余额：
```bash
# 目标地址
solana balance 2XM48QdtTv3dAHccUjVdZ2CF7Es3estfNRAqjjde8QdL --url http://localhost:8899

# 您的钱包地址
solana balance [您的钱包地址] --url http://localhost:8899
```

### 查询交易：
```bash
# 如果有交易哈希
solana transaction [交易哈希] --url http://localhost:8899

# 查看最近的交易
solana transaction-history [您的钱包地址] --url http://localhost:8899
```

### 网络状态：
```bash
# 检查网络连接
solana ping --url http://localhost:8899

# 检查区块高度
solana block-height --url http://localhost:8899
```

## 🚀 下一步行动

1. **执行转账操作**
2. **仔细查看控制台日志**
3. **使用 "检查目标地址余额" 按钮**
4. **如果仍然没有变化，请提供控制台日志输出**

这样我们就能准确定位问题所在！

## 💡 提示

- 如果交易确实发送成功，您应该能在日志中看到真实的交易哈希
- 交易哈希可以用来在区块链浏览器或命令行中查询交易详情
- 本地测试网络的交易通常会立即确认
- 如果余额没有变化，很可能是交易根本没有发送到网络
