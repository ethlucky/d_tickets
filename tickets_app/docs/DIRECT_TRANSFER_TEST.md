# ç›´æ¥ SOL è½¬è´¦æµ‹è¯•

## ğŸ¯ é—®é¢˜è§£å†³

ä¹‹å‰çš„ "æµ‹è¯•ç­¾åè¯·æ±‚" æŒ‰é’®å‡ºç°äº†äº¤æ˜“æ ¼å¼é”™è¯¯ï¼š
```
failed to deserialize solana_sdk::transaction::versioned::VersionedTransaction
```

è¿™ä¸ªé”™è¯¯è¡¨æ˜æˆ‘ä»¬çš„äº¤æ˜“æ„å»ºæµç¨‹æœ‰é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ **"ç›´æ¥ SOL è½¬è´¦æµ‹è¯•"** æŒ‰é’®ï¼Œå®ƒä½¿ç”¨æ›´ç®€å•ç›´æ¥çš„æ–¹æ³•æ¥æ„å»ºå’Œå‘é€äº¤æ˜“ã€‚

## âœ… æ–°å¢åŠŸèƒ½

### 1. **ç›´æ¥ SOL è½¬è´¦æµ‹è¯•æŒ‰é’®**
- **ä½ç½®**ï¼šåœ¨ "æ£€æŸ¥ç›®æ ‡åœ°å€ä½™é¢" æŒ‰é’®ä¸‹æ–¹
- **é¢œè‰²**ï¼šç»¿è‰²
- **åŠŸèƒ½**ï¼šç›´æ¥æ„å»ºã€ç­¾åå’Œå‘é€ SOL è½¬è´¦äº¤æ˜“

### 2. **ç®€åŒ–çš„äº¤æ˜“æµç¨‹**
```dart
Future<void> testDirectSolTransfer() async {
  // 1. è·å–æœ€æ–°åŒºå—å“ˆå¸Œ
  final recentBlockhash = await _getRecentBlockhash();
  
  // 2. åˆ›å»ºè½¬è´¦æŒ‡ä»¤
  final instruction = SystemInstruction.transfer(
    fundingAccount: Ed25519HDPublicKey.fromBase58(_walletAddress),
    recipientAccount: Ed25519HDPublicKey.fromBase58(targetAddress),
    lamports: (transferAmount * 1000000000).toInt(),
  );
  
  // 3. åˆ›å»ºäº¤æ˜“æ¶ˆæ¯
  final message = Message(instructions: [instruction]);
  
  // 4. ç¼–è¯‘äº¤æ˜“
  final compiledMessage = message.compile(
    recentBlockhash: recentBlockhash,
    feePayer: Ed25519HDPublicKey.fromBase58(_walletAddress),
  );
  
  // 5. ç­¾åäº¤æ˜“
  final signature = await mobileWalletService.keyPair.sign(compiledMessage.toByteArray());
  
  // 6. æ„é€ å·²ç­¾åäº¤æ˜“
  final signedTx = SignedTx(
    compiledMessage: compiledMessage,
    signatures: [Signature(signature.bytes)],
  );
  
  // 7. å‘é€äº¤æ˜“
  final txSignature = await _solanaClient.rpcClient.sendTransaction(
    signedTx.encode(),
    encoding: Encoding.base64,
    preflightCommitment: Commitment.confirmed,
  );
  
  // 8. åˆ·æ–°ä½™é¢
  await refreshBalance();
}
```

## ğŸ” æµ‹è¯•æ­¥éª¤

### 1. **å‡†å¤‡å·¥ä½œ**
- ç¡®ä¿é’±åŒ…å·²è¿æ¥
- ç¡®ä¿é’±åŒ…æœ‰è¶³å¤Ÿçš„ SOL ä½™é¢ï¼ˆè‡³å°‘ 0.02 SOLï¼‰

### 2. **æ‰§è¡Œæµ‹è¯•**
1. ç‚¹å‡» **"ç›´æ¥ SOL è½¬è´¦æµ‹è¯•"** æŒ‰é’®ï¼ˆç»¿è‰²æŒ‰é’®ï¼‰
2. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸš€ å¼€å§‹ç›´æ¥ SOL è½¬è´¦æµ‹è¯•...
   âœ… è·å–åŒºå—å“ˆå¸Œ: [çœŸå®å“ˆå¸Œ]
   âœ… åˆ›å»ºè½¬è´¦æŒ‡ä»¤å®Œæˆ
   âœ… ç¼–è¯‘äº¤æ˜“å®Œæˆ
   âœ… ç­¾åäº¤æ˜“å®Œæˆ
   âœ… äº¤æ˜“å‘é€æˆåŠŸ: [äº¤æ˜“ç­¾å]
   ```
3. ç‚¹å‡» **"æ£€æŸ¥ç›®æ ‡åœ°å€ä½™é¢"** æŒ‰é’®éªŒè¯ä½™é¢å˜åŒ–

### 3. **é¢„æœŸç»“æœ**
- âœ… ç›®æ ‡åœ°å€ `2XM48QdtTv3dAHccUjVdZ2CF7Es3estfNRAqjjde8QdL` ä½™é¢å¢åŠ  0.01 SOL
- âœ… æ‚¨çš„é’±åŒ…ä½™é¢å‡å°‘ 0.01 SOL + äº¤æ˜“è´¹
- âœ… è·å¾—çœŸå®çš„äº¤æ˜“ç­¾å
- âœ… å¯ä»¥åœ¨ Solana Explorer ä¸­æŸ¥çœ‹äº¤æ˜“

## ğŸ†š æŒ‰é’®å¯¹æ¯”

### âŒ **"æµ‹è¯•ç­¾åè¯·æ±‚"** æŒ‰é’®
- **é—®é¢˜**ï¼šäº¤æ˜“æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è¢«ç½‘ç»œè§£æ
- **é”™è¯¯**ï¼š`failed to deserialize solana_sdk::transaction::versioned::VersionedTransaction`
- **çŠ¶æ€**ï¼šæš‚æ—¶æœ‰é—®é¢˜

### âœ… **"ç›´æ¥ SOL è½¬è´¦æµ‹è¯•"** æŒ‰é’®
- **ä¼˜åŠ¿**ï¼šä½¿ç”¨æ­£ç¡®çš„ Solana SDK API
- **æµç¨‹**ï¼šç›´æ¥æ„å»ºã€ç­¾åã€å‘é€
- **çŠ¶æ€**ï¼šåº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œ

### âœ… **"æ£€æŸ¥ç›®æ ‡åœ°å€ä½™é¢"** æŒ‰é’®
- **åŠŸèƒ½**ï¼šæŸ¥è¯¢ç›®æ ‡åœ°å€å½“å‰ä½™é¢
- **ç”¨é€”**ï¼šéªŒè¯è½¬è´¦æ˜¯å¦æˆåŠŸ

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å…³é”®æ”¹è¿›ï¼š
1. **æ­£ç¡®çš„äº¤æ˜“æ„å»º**ï¼šä½¿ç”¨ `Message` å’Œ `CompiledMessage`
2. **æ­£ç¡®çš„ç­¾åæµç¨‹**ï¼šç›´æ¥ä½¿ç”¨ `keyPair.sign()`
3. **æ­£ç¡®çš„äº¤æ˜“æ ¼å¼**ï¼šä½¿ç”¨ `SignedTx` æ„é€ å·²ç­¾åäº¤æ˜“
4. **æ­£ç¡®çš„å‘é€æ–¹å¼**ï¼šä½¿ç”¨ `signedTx.encode()` ç¼–ç 

### ç½‘ç»œé…ç½®ï¼š
- **ç›®æ ‡åœ°å€**ï¼š`2XM48QdtTv3dAHccUjVdZ2CF7Es3estfNRAqjjde8QdL`
- **è½¬è´¦é‡‘é¢**ï¼š0.01 SOL
- **ç½‘ç»œ**ï¼šæœ¬åœ°æµ‹è¯•ç½‘ç»œ (localhost:8899)

## ğŸ“Š è°ƒè¯•ä¿¡æ¯

å¦‚æœç›´æ¥è½¬è´¦æµ‹è¯•ä»ç„¶å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºå¹¶æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. å®Œæ•´çš„é”™è¯¯æ¶ˆæ¯
2. äº¤æ˜“æ„å»ºè¿‡ç¨‹ä¸­çš„æ—¥å¿—
3. ç½‘ç»œè¿æ¥çŠ¶æ€
4. é’±åŒ…ä½™é¢æƒ…å†µ

## ğŸ’¡ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•ç›´æ¥è½¬è´¦**ï¼šç‚¹å‡»ç»¿è‰²çš„ "ç›´æ¥ SOL è½¬è´¦æµ‹è¯•" æŒ‰é’®
2. **éªŒè¯ç»“æœ**ï¼šä½¿ç”¨ "æ£€æŸ¥ç›®æ ‡åœ°å€ä½™é¢" æŒ‰é’®ç¡®è®¤
3. **æŸ¥çœ‹æ—¥å¿—**ï¼šè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºçš„è¯¦ç»†ä¿¡æ¯
4. **æŠ¥å‘Šç»“æœ**ï¼šå‘Šè¯‰æˆ‘æµ‹è¯•ç»“æœå¦‚ä½•

è¿™ä¸ªæ–°çš„ç›´æ¥è½¬è´¦æ–¹æ³•åº”è¯¥èƒ½å¤ŸæˆåŠŸå‘é€çœŸå®çš„ SOL è½¬è´¦äº¤æ˜“ï¼ğŸš€
